easyblock = 'CMakeMake'

name = 'Dalton'
version = '2020.0'

homepage = 'https://daltonprogram.org/'
description = """The Dalton code is a powerful tool for a wide range of molecular properties
 at different levels of theory.
 Any published work arising from use of one of the Dalton2016 programs
 must acknowledge that by a proper reference,
 https://www.daltonprogram.org/www/citation.html."""

toolchain = {'name': 'foss', 'version': '2020b'}
toolchainopts = {'usempi': True, 'openmp': True}

sources = [{
    'filename': SOURCE_TAR_GZ,
    'git_config': {
        'url': 'https://gitlab.com/dalton',
        'repo_name': 'dalton',
        'tag': 'Dalton%(version)s',
        'recursive': True,
    },
}]

checksums = ['a939dfbf869ef90ea064fa3d00cc1937dd145438947ecf5556f964b38299b34a']

builddependencies = [('CMake', '3.18.4'), ('Python', '3.8.6')]

configure_cmd = 'python ../dalton/setup --prefix="%(installdir)s" .'

# From Dalton documentation:
#   Once the build is complete, you can run the test set as:
#   $ ctest [-j4] -L dalton
# according to other easybuilds (that do it this way) it is not possible to pass the extra option through
# 'runtests'
buildopts = "&& ctest --output-on-failure -L dalton"

separate_build_dir = True

sanity_check_paths = {
    'files': ['dalton/dalton', 'dalton/dalton.x'],
    'dirs': ['dalton/basis'],
}

moduleclass = 'chem'
